<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>ft_transcendence</title>
	<style>
		body { margin: 0; }
	</style>
</head>
<body>
	{% load static %}
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
	<script type="module" src="{% static 'js/game/Scene.js' %}"></script>
	<script type="module" src="{% static 'js/game/Ball.js' %}"></script>
	<script type="module">

		// Import all the functions from the other files
		import { initScene } from "{% static 'js/game/Scene.js' %}";
		import { initBall } from "{% static 'js/game/Ball.js' %}";
		import { initGround } from "{% static 'js/game/Ground.js' %}";
		import { initPaddle } from "{% static 'js/game/Paddle.js' %}";
		import { initLights } from "{% static 'js/game/Lights.js' %}";
		import { initInputs } from "{% static 'js/game/Inputs.js' %}";

		// Initialize every components
		const { scene, camera, renderer } = initScene();
		const { ballGeometry, ballMaterial, ball } = initBall();
		const { groundGeometry, groundMaterial, ground } = initGround();
		const { paddle: paddleLeft } = initPaddle(-10, 0, 0);
		const { paddle: paddleRight } = initPaddle(10, 0, 0);
		const { light } = initLights(camera);
		let { movePaddleLeftUp, movePaddleLeftDown, movePaddleRightUp, movePaddleRightDown } = initInputs();

		// Add all objects to the scene
		scene.add(ball);
		scene.add(ground);
		scene.add(paddleLeft);
		scene.add(paddleRight);
		scene.add(light);

		// Time variables
		let lastTime = 0;
		let deltaTime = 0;

		// Inputs logic
		window.addEventListener('keydown', function(event) {
			if (event.key === 'q' || event.key === 'Q') movePaddleLeftUp = true;
			else if (event.key === 'a' || event.key === 'A') movePaddleLeftDown = true;
			else if (event.key === 'p' || event.key === 'P') movePaddleRightUp = true;
			else if (event.key === 'l' || event.key === 'L') movePaddleRightDown = true;
		});
		window.addEventListener('keyup', function(event) {
			if (event.key === 'q' || event.key === 'Q') movePaddleLeftUp = false;
			else if (event.key === 'a' || event.key === 'A') movePaddleLeftDown = false;
			else if (event.key === 'p' || event.key === 'P') movePaddleRightUp = false;
			else if (event.key === 'l' || event.key === 'L') movePaddleRightDown = false;
		});

		// Game logic
		const paddleSpeed = 10; // Paddle speed in units per second
		const randomRotationY = Math.random() * Math.PI * 2; // Random rotation along Y axis
		//ball.velocity = new THREE.Vector3(0.01, 0, 0); // Moving right at 1 unit per second

		// Render and animation
		function animate(time)
		{
			requestAnimationFrame(animate);

			// Calculate deltaTime for frame-independent movement
			deltaTime = (time - (lastTime || time)) / 1000;
			lastTime = time;

			// Inputs logic
			if (movePaddleLeftUp) paddleLeft.position.z -= paddleSpeed * deltaTime;
			if (movePaddleLeftDown) paddleLeft.position.z += paddleSpeed * deltaTime;
			if (movePaddleRightUp) paddleRight.position.z -= paddleSpeed * deltaTime;
			if (movePaddleRightDown) paddleRight.position.z += paddleSpeed * deltaTime;

			// Update ball's position
			ball.position.x -= 0.01;

			renderer.render(scene, camera);
		}

		animate(); // Start the animation loop

	</script>
</body>
</html>

