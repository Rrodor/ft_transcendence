{% extends "master.html" %}

{% block title %}
	Details about {{ player.username }}
{% endblock %}

{% block content %}
	<body style="background-color: black;">
		<div class="container py-5 h-100">
			<!-- Section pour les informations du joueur -->
			<div class="row">
				<div class="col-md-4 offset-md-4">
					<div class="card" style="border-radius: 15px;">
						<div class="card-body text-center">
							<div class="mt-3 mb-4">
								<img src="{% if player.avatar %}{{ player.avatar.url }}{% else %}https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava2-bg.webp{% endif %}"
									 class="rounded-circle img-fluid" style="width: 100px;">
							</div>
							<h4 class="mb-2">{{ player.username }}</h4>
							{% if player.email %}
								<p class="text-muted mb-4">{{ player.email }}<span class="mx-2">|</span>Id: {{ player.id }}</p>
							{% else %}
								<p class="text-muted mb-4" style="text-align: center;">Id: {{ player.id }}</p>
							{% endif %}
							<hr>
							Pong - {{ player.total_pong_games }} games
							<div class="col-12 d-flex justify-content-between text-end small">
								<span>Wins: {{ player.pong_victories }}</span>
								<span>Loses: {{ player.pong_defeats }}</span>
							</div>  
							{% if player.pong_defeats == 0 and player.pong_victories == 0 %}
								<div class="progress" role="progressbar" aria-label="Victories and Defeats" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
									<div class="progress-bar bg-secondary" style="width: 100%;" aria-valuenow="100">No matches played yet
									</div>
								</div>
							{% else %}
								<div class="progress" role="progressbar" aria-label="Victories and Defeats" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
									<div class="progress-bar bg-success" style="width: {{ player.pong_victories_percentage }}%;" aria-valuenow="{{ player.pong_victories_percentage }}"></div>
									<div class="progress-bar bg-danger" style="width: {{ player.pong_defeats_percentage }}%;" aria-valuenow="{{ player.pong_defeats_percentage }}"></div>
								</div>
							{% endif %}
							<hr>    
							Hexa-Race:
							3 V | 7 L
							<div class="progress" role="progressbar" aria-label="Victories and Defeats" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
								<div class="progress-bar bg-success" style="width: 30%;" aria-valuenow="30"></div>
								<div class="progress-bar bg-danger" style="width: 70%;" aria-valuenow="70"></div>
							</div>
							<hr>
							{% if user.is_authenticated %}
								{% if not is_friend %}
									{% if not is_pending %}
										<form action="{% url 'add_friend' player.id %}" method="POST">
											{% csrf_token %}
											<button type="submit" class="btn btn-primary btn-rounded btn-lg">Add friend</button>
										</form>
									{% endif %}
								{% else %}
									<form action="{% url 'remove_friend' player.id %}" method="POST">
										{% csrf_token %}
										<button type="submit" class="btn btn-danger btn-rounded btn-lg">Remove friend</button>
									</form>
						</div>
						<div class="overlay"></div>
					</div>
				</div>
			</div>
	
			<!-- Section pour le graphique -->
			<div class="row">
				<div class="col-12">
					<div class="card mb-4 mt-4" style="border-radius: 15px;">
						<div id="statsCarousel" class="carousel slide" data-bs-interval="false">
							<div class="carousel-inner">
								<div class="carousel-item active">
									<div class="row">
										<!-- Colonne de gauche pour le graphique et le nombre de parties -->
										<div class="col-md-6">
											<div class="graphique-conteneur" style="text-align: center;">
												<p style="font-weight: bold; margin-bottom: 0;">
													Number of games played (Pong):<br>
													{{ user_stats.total_pong_games }}
												</p>
												<div>
													<div id="chart-data" data-pong-victories="{{ user_stats.pong_victories }}" data-pong-defeats="{{ user_stats.pong_defeats }}"></div>
													<canvas id="myChart1"></canvas>
												</div>
											</div>
										</div>
								
										<!-- Colonne de droite pour les moyennes -->
										<div class="col-md-6">
											<div class="moyenne-encart-conteneur">
												<div class="moyenne-encart">
													<div class="moyenne-texte">
														<p style="font-weight: bold;">Average points for :</p>
													</div>
													<div class="moyenne-stat">
														<p style="font-weight: bold;">{{ user_stats.pong_average_for|floatformat:2 }}</p>
													</div>
												</div>
												<div class="moyenne-encart">
													<div class="moyenne-texte">
														<p style="font-weight: bold;">Average points against :</p>
													</div>
													<div class="moyenne-stat">
														<p style="font-weight: bold;">{{ user_stats.pong_average_against|floatformat:2 }}</p>
													</div>
												</div>
												<div class="moyenne-encart">
													<div class="moyenne-texte">
														<p style="font-weight: bold;">W/L Ratio :</p>
													</div>
													<div class="moyenne-stat">
														<p style="font-weight: bold;">{{ user_stats.pong_wl_ratio|floatformat:2 }}</p>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="carousel-item">
									<div class="row">
										<!-- Colonne de gauche pour l'histogramme et le nombre de parties -->
										<div class="col-md-6">
											<div class="graphique-conteneur" style="text-align: center;">
												<p style="font-weight: bold; margin-bottom: 0;">
													{% if user.is_authenticated and request.user.language == 'fr' %}
													Nombre de parties jouees (Casse briques):
													{% elif user.is_authenticated and request.user.language == 'sp' %}
													Cantidad de partidas jugadas (Rompe Lardillos):
													{% else %}
													Number of games played (Brick Breaker):
													{% endif %}
													{{ user_stats.brick_games }}</p>
												<div>
													<script type="text/javascript">
														window.brickScores = {{ latest_brick_score|safe }};
													</script>
													<canvas id="myChart2"></canvas>
												</div>
											</div>
										</div>													
										<div class="col-md-6">
											<div class="moyenne-encart-conteneur">
												<!-- Ici, vous pouvez ajouter les moyennes et autres statistiques pour le jeu Brick Breaker -->
												<div class="moyenne-encart">
													<div class="moyenne-texte">
														{% if user.is_authenticated and request.user.language == 'fr' %}
															<p style="font-weight: bold;">Score moyen:</p>
														{% elif user.is_authenticated and request.user.language == 'sp' %}
															<p style="font-weight: bold;">Puntuaci√≥n media:</p>
														{% else %}
															<p style="font-weight: bold;">Average Score:</p>
														{% endif %}
													</div>
													<div class="moyenne-stat">
														<p style="font-weight: bold;">{{ user_stats.brick_average|floatformat:2 }}</p>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<a class="carousel-control-prev" href="#statsCarousel" role="button" data-bs-slide="prev" style="color: black; left: -25px;">
								<span class="carousel-control-prev-icon" aria-hidden="true"></span>
							</a>
							<a class="carousel-control-next" href="#statsCarousel" role="button" data-bs-slide="next" style="color: black;">
								<span class="carousel-control-next-icon" aria-hidden="true"></span>
							</a>
						</div>
					</div>
					<div class="card">
						<div class="card-body">
							<h5 class="card-title fw-bold">Last 5 games</h5>
							<ul class="list-group">
								{% for game in latest_games %}
									<li class="list-group-item game-info">
										<div class="game-result">
											{% if game.game_type == 'PONG' %}
												{% if game.score_left > game.score_right %}
													<span class="text-success fw-bold">VICTORY</span>
												{% else %}
													<span class="text-danger fw-bold">DEFEAT</span>
												{% endif %}
											{% else %}
												<span class="text-score fw-bold">SCORE</span>
											{% endif %}
										</div>
										<div>{{ game.get_game_type_display }}</div>
										<div>
											{% if game.game_type == 'PONG' %}
												{{ game.score_left }} - {{ game.score_right }}
											{% else %}
												{{ game.score }}
											{% endif %}
										</div>
										<div>{{ game.date|date:"d/m/Y H:i" }}</div>
									</li>
								{% empty %}
									<li class="list-group-item">No recent games.</li>
								{% endfor %}
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% endif %}
		{% endif %}
		</div>
	</body>
{% endblock %}
